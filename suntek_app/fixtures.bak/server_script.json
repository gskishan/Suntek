[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-17 13:49:57.000186",
  "module": null,
  "name": "Prevent lead creation with same mobile number",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Lead",
  "script": "if doc.mobile_no:\n    mobile_no = str(doc.mobile_no).strip()\n    \n    # Check for duplicates\n    duplicate_lead = frappe.db.get_list('Lead', \n        filters={\n            'mobile_no': mobile_no,\n            'name': ['!=', doc.name]\n        },\n        fields=['name', 'custom_enquiry_owner_name'],\n        limit=1\n    )\n    \n    if duplicate_lead:\n        frappe.throw(\n            f\"Cannot use duplicate mobile no {mobile_no}. Lead <b>{duplicate_lead[0].name}</b> with {mobile_no} already exists.\"\n        )",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-09 11:50:12.799294",
  "module": null,
  "name": "quoation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Quotation",
  "script": "for d in doc.items:\n    d.custom_total_gst_rate=d.igst_rate+d.cgst_rate+d.sgst_rate\n    d.custom_total_gst_amount=d.igst_amount+d.cgst_amount+d.sgst_amount\n    if doc.custom_opportunity_name:\n        d.prevdoc_doctype=\"Opportunity\"\n        d.prevdoc_docname=doc.custom_opportunity_name\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-04-15 14:44:33.586522",
  "module": null,
  "name": "Site Survey Submit",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Site Survey",
  "script": "dgn=frappe.new_doc(\"Designing\")\ndgn.site_engineer=doc.site_engineer\ndgn.site_survey=doc.name\ndgn.custom_project=doc.custom_project\n\ndgn.customer_name=doc.customer_name\ndgn.customer_number=doc.customer_number\ndgn.opportuniy_owner=doc.opportunity_owner\ndgn.sales_person=doc.sales_person\ndgn.poc_name=doc.poc_name\ndgn.poc_contact=doc.poc_contact\n\n\n\ndgn.opportunity_name=doc.opportunity_name\nopp=frappe.get_doc(\"Opportunity\",doc.opportunity_name)\nif opp.custom_capacity:\n    dgn.custom_capacity=opp.custom_capacity\ndgn.save()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Validate",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-03-12 11:36:51.066629",
  "module": null,
  "name": "Enquiry Validation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Lead",
  "script": "\r\nleads = frappe.db.get_list('Lead',\r\n    filters={\r\n        'mobile_no': doc.mobile_no\r\n    },\r\n    fields=['name', 'mobile_no'],\r\n    as_list=True\r\n)\r\n\r\nif leads:\r\n    frappe.throw(\"Duplicate Mobile no {0}\".format(doc.mobile_no))\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-12-31 10:13:31.196573",
  "module": "CRM",
  "name": "Link attachments between Enquiry and Opportunity",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Opportunity",
  "script": "if doc.party_name != \"\":\n    enquiry_attachments = frappe.get_all(\"File\",\n    filters = {\n        'attached_to_doctype': 'Lead',\n        'attached_to_name': doc.party_name\n    },\n    fields = ['file_name', 'file_url'],\n    )\n    \n    if enquiry_attachments:\n        for attachment in enquiry_attachments:\n            has_attachment = frappe.db.get_value(\"File\", {\n                'file_url': attachment.file_url,\n                'attached_to_doctype': 'Opportunity',\n                'attached_to_name': doc.name\n            })\n            \n            if not has_attachment:\n                opportunity_attachment = frappe.get_doc({\n                    'doctype': 'File',\n                    'file_name': attachment.file_name,\n                    'file_url': attachment.file_url,\n                    'attached_to_doctype': 'Opportunity',\n                    'attached_to_name': doc.name\n                })\n                \n                opportunity_attachment.insert()\n                opportunity_attachment.reload()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-02 16:43:55.933802",
  "module": "suntek",
  "name": "Sync Enquiry Status",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Lead",
  "script": "advanced_statuses = [\n    \"Replied\",\n    \"Opportunity\", \n    \"Quotation\",\n    \"Lost Quotation\",\n    \"Converted\"\n]\n\nif doc.status not in advanced_statuses:\n    if doc.custom_enquiry_status in [\"Interested\", \"Do Not Contact\"]:\n        doc.status = doc.custom_enquiry_status",
  "script_type": "DocType Event"
 }
]